<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.binblur.mapper.contact">

    <sql id="contactColumns">
        , ID                AS id
        , USER_ID           AS userId
        , TRAN_TYPE         AS tranType
        , URI               AS uri
        , URI_NM            AS uriNm
        , INPUT_PARAM_CNTN  AS inputParamCntn
        , CONTACT_IP        AS contactIp
        , CRE_USER          AS creUser
        , CRE_TM            AS creTm
        , UPD_USER          AS updUser
        , UPD_TM            AS updTm
        , DEL_YN            AS delYn
    </sql>


    <select id="selectContactListPaging" parameterType="com.shop.core.biz.common.vo.request.PageRequest" resultType="com.shop.core.biz.system.vo.response.ContactResponse$Paging">
        /* com.binblur.mapper.contact.selectContactListPaging */
        SELECT
             ( COUNT(1) OVER() )                          AS totalRowCount
           , ROW_NUMBER() OVER(ORDER BY A.ID ASC)            AS no
           , A.ID                AS id
           , A.USER_ID           AS userId
           , A.TRAN_TYPE         AS tranType
           , FN_GET_CODE('50050',A.TRAN_TYPE) AS tranTypeNm
           , A.URI               AS uri
           , A.URI_NM            AS uriNm
           , A.INPUT_PARAM_CNTN  AS inputParamCntn
           , A.CONTACT_IP        AS contactIp
           , A.CRE_USER          AS creUser
           , A.CRE_TM            AS creTm
           , A.UPD_USER          AS updUser
           , A.UPD_TM            AS updTm
           , A.DEL_YN            AS delYn
           , B.LOGIN_ID          AS loginId
           , B.BELONG_NM         AS belongNm
           , B.BELONG_NM         AS belongNm
           , B.POSITION_NM       AS positionNm
           , FN_GET_CODE('10020',B.AUTH_CD) AS authNm
           , B.USER_NM
           , B.DEPT_NM AS deptnm
           , A.CRE_TM
        FROM TB_CONTACT A
        LEFT OUTER JOIN TB_USER B ON B.ID = A.USER_ID
        WHERE 1 = 1
        <if test='filter.loginId != null and !filter.loginId.equals("")'>
            AND USER_ID = #{filter.loginId}
        </if>
        <if test='filter.tranType != null and !filter.tranType.equals("")'>
            AND TRAN_TYPE = #{filter.tranType}
        </if>
        <if test='filter.partnerId != null and !filter.partnerId.equals("")'>
            AND A.PARTNER_ID = #{filter.partnerId}
        </if>
        ORDER BY A.ID DESC
        OFFSET ((#{curPage}-1) * #{pageRowCount}) ROWS FETCH NEXT #{pageRowCount} ROWS ONLY

    </select>

    <insert id="insertContact" parameterType="com.shop.core.vo.request.ContactRequest" useGeneratedKeys="true" keyProperty="id">
        /* com.binblur.mapper.contact.insertContact */
        INSERT INTO TB_CONTACT
        (
          USER_ID
        ,TRAN_TYPE
        ,URI
        ,URI_NM
        ,INPUT_PARAM_CNTN
        ,CONTACT_IP
        ,CRE_USER
        ,UPD_USER
        ,PARTNER_ID
        )
        VALUES
            (
              #{userId}
            , #{tranType}
            , #{uri}
            , #{uriNm}
            , #{inputParamCntn}
            , #{contactIp}
            , #{creUser}
            , #{creUser}
            , #{partnerId}
            )
    </insert>


</mapper>
