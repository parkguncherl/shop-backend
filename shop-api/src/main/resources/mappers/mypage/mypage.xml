<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop.mapper.mypage">

    <select id="selectFavorites" parameterType="com.shop.core.biz.mypage.vo.request.FavoritesRequest$FavoritesListRequest" resultType="com.shop.core.biz.mypage.vo.response.FavoritesResponse$SelectFavorites">
        /* com.shop.mapper.mypage.selectFavorites */
        SELECT
              A.MENU_URI AS menuUri
            , B.MENU_NM AS menuNm
         FROM TB_FAVORITES A
         JOIN TB_MENU B ON A.MENU_URI = B.MENU_URI AND B.DEL_YN ='N'
        WHERE A.USER_ID = #{id}
          AND A.AUTH_CD = #{authCd}
        <if test='menuUri != null  and !menuUri.equals("")'>
            AND A.MENU_URI = #{menuUri}
        </if>
          AND A.DEL_YN ='N'
        ORDER BY A.DIST_SEQ ASC
    </select>

    <insert id="insertFavorites" parameterType="com.shop.core.entity.Favorites" >
    /* com.shop.mapper.mypage.insertFavorites */
        INSERT INTO TB_FAVORITES (
             USER_ID
           , MENU_URI
           , AUTH_CD
           , DIST_SEQ
           , CRE_USER
           , CRE_TM
           , UPD_USER
           , UPD_TM
        )
        VALUES
        (
             #{userId}
           , #{menuUri}
           , #{authCd}
           , (SELECT COALESCE(MAX(DIST_SEQ), 0) + 1 FROM TB_FAVORITES WHERE USER_ID = #{userId} and AUTH_CD = #{authCd})
           , #{creUser}
           , now()
           , #{updUser}
           , now()
        )
    </insert>

    <delete id="deleteFavorites" parameterType="com.shop.core.entity.Favorites" >
        /* com.shop.mapper.mypage.deleteFavorites */
        DELETE FROM TB_FAVORITES
         WHERE USER_ID = #{userId}
           AND MENU_URI = #{menuUri}
    </delete>

    <delete id="deleteFavoritesAll" parameterType="com.shop.core.entity.Favorites" >
        /* com.shop.mapper.mypage.deleteFavoritesAll */
        DELETE FROM TB_FAVORITES
        WHERE USER_ID = #{userId}
    </delete>

    <update id="deletePartnerPrint" parameterType="Integer">
        /* com.shop.mapper.mypage.deletePartnerPrint */
        UPDATE TB_PARTNER_PRINT
        SET DEL_YN = 'Y'
        WHERE PARTNER_ID = #{partnerId}
    </update>


</mapper>
