<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.binblur.mapper.contact">

    <sql id="contactColumns">
          ID                AS id
        , USER_ID           AS userId
        , TRAN_TYPE         AS tranType
        , URI               AS uri
        , URI_NM            AS uriNm
        , INPUT_PARAM_CNTT  AS inputParamCntt
        , CONTACT_IP        AS contactIp
        , CRE_USER          AS creUser
        , CRE_TM            AS creTm
        , UPD_USER          AS updUser
        , UPD_TM            AS updTm
        , DEL_YN            AS delYn
    </sql>


    <select id="selectContactListPaging" parameterType="com.binblur.core.vo.request.PageRequest" resultType="com.binblur.core.biz.system.vo.response.ContactResponse">
        /* com.binblur.mapper.contact.selectContactListPaging */
        SELECT ( COUNT(1) OVER() )                          AS totalRowCount
            , ROW_NUMBER() OVER(ORDER BY ID ASC)            AS no
        <include refid="contactColumns"></include>
        FROM TB_CONTACT
        WHERE 1 = 1
--           AND DEL_YN = 'N' // 삭제여부를 사용여부로 관리
        <if test='filter.userId != null and !filter.userId.equals("")'>
            AND USER_ID = #{filter.userId}
        </if>
        <if test='filter.tranType != null and !filter.tranType.equals("")'>
            AND TRAN_TYPE = #{filter.tranType}
        </if>
        <if test='filter.tranDay != null and !filter.tranDay.equals("")'>
            AND CRE_TM BETWEEN #{filter.tranDay} AND #{filter.tranDay}
        </if>
        ORDER BY ID DESC
        OFFSET (#{curPage}-1) * #{pageRowCount} ROWS
        FETCH NEXT #{pageRowCount} ROWS ONLY
    </select>

    <insert id="insertContact" parameterType="com.binblur.core.vo.request.ContactRequest" useGeneratedKeys="true" keyProperty="id">
        /* com.binblur.mapper.contact.insertContact */
        INSERT INTO TB_CONTACT
        (
             USER_ID
            ,TRAN_TYPE
            ,URI
            ,URI_NM
            ,INPUT_PARAM_CNTN
            ,CONTACT_IP
            ,CRE_USER
            ,UPD_USER
        )
        VALUES
        (
              #{userId}
            , #{tranType.code}
            , #{uri}
            , #{uriNm}
            , #{inputParamCntn}
            , #{contactIp}
            , #{createUser}
            , #{createUser}
        )
    </insert>


</mapper>
